{% extends "base.html" %}
{% block content %}
<div class="form-wrapper">
    <div class="form-card">
        <h2 class="form-title">Seleziona Esperimenti da Rimuovere</h2>
        
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{% if message.tags %}{{ message.tags }}{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <form method="post" id="removeForm">
            {% csrf_token %}
            
            <!-- Brand -->
            <div class="form-group">
                <label for="id_brand">Marca</label>
                {{ form.brand }}
            </div>

            <!-- Model -->
            <div class="form-group">
                <label for="id_model">Modello</label>
                {{ form.model }}
            </div>

            <!-- Modalità -->
            <div class="form-group">
                <label for="id_mode">Modalità</label>
                {{ form.mode }}
            </div>

            <div class="submit-container">
                <button type="submit" class="red-delete-button" onclick="return confirm('Sei sicuro di voler eliminare tutti gli esperimenti che corrispondono a questi criteri?')">
                    Rimuovi Esperimenti
                </button>
                <a href="{% url 'experiments:list' %}" class="custom-red-btn">Annulla</a>
            </div>
        </form>
    </div>
</div>

<div id="confirmModal" class="modal" style="display: none;" data-show="{{ request.GET.removed|yesno:'1,0' }}">
    <div class="modal-content">
        <p>Esperimento rimosso con successo.</p>
        <button id="modalHomeBtn">Vai alla lista</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Dinamically update models when brand changes
    const brandSelect = document.getElementById('id_brand');
    const modelSelect = document.getElementById('id_model');
    
    brandSelect.addEventListener('change', function() {
        const brand = this.value;
        if (brand) {
            fetch(`/experiments/get-models/?brand=${encodeURIComponent(brand)}`)
                .then(response => response.json())
                .then(data => {
                    modelSelect.innerHTML = '<option value="">---</option>';
                    data.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        modelSelect.appendChild(option);
                    });
                });
        } else {
            modelSelect.innerHTML = '<option value="">---</option>';
        }
    });
});
</script>
{% endblock %}